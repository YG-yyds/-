# 概率攻击图上的最佳安全加固方案：使用CySecTool的工控系统案例研究

## 简介

CySecTool是一个在给定预算内为概率攻击图找到成本最优的安全控制组合的工具。CySecTool使用户能够快速创建、编辑和逐步改进模型，分析给定组合的结果，并以一个帕累托边界(Pareto frontier)的形式显示所有可能预算的最佳解决方案。

**案例研究：** 根据一个工业来源准备的疑似攻击路径进行案例研究。目的是建立一个监督控制和数据采集(SCADA)工控模型。系统需要强有力保护，不允许使用典型渗透工具(如漏洞扫描器)。分析展示使用CySecTool存储网络安全情报并得出进一步的结论的过程。

**研究背景：**

网络安全组合(portfolio)是公司针对漏洞采取的一套措施，又称控制措施(controls)，类别有：恶意软件防御，控制使用权限，渗透测试，安全培训计划。

IT系统可以被模拟成一个攻击图，该案例中是特权图，节点代表一组特权，边代表攻击者通过利用漏洞获得的额外特权。

[1]描述一种概率攻击图上实现min-max优化的方法，在给定预算下获得最佳安全性(最小化到目标最大流量)的组合。下一步是建立攻击图，边有概率流量(攻击成功概率)，有定义流量减少的控制措施(采用安全措施，攻击成功概率减少)。

基于ClearSCADA的工控系统是网络安全决策支持的一个重要应用领域。这种ICS是在工厂中运行并控制机械设备的软件，工厂系统图和可疑攻击路径由工业安全工程师根据工作获得。

**贡献：**

解释[1]中min-max优化的工具设计选择和特点，展示其在真实SCADA系统中的应用。建立一个与优化算法紧密结合、存在攻击者和编辑者、实现攻击图可视化的软件包(CySecTool)，通过案例证明该方法有效性(根据信息建立攻击图模型，扮演安全分析员角色从模型得出合理结论)。

<img src="pic\p5\p1.png" width="50%" />

图1: 分析的工业案例，分为操作技术(OT)，IT和现场设备。下划线是控制系统和他的两个主要接口WebX和ViewX。

### 文献回顾

**攻击图建模：** 访问控制模型：建模访问矩阵(access matrix)，存在无法检查用户是否能获得一个对象的访问的安全问题。为解决安全问题开发模型take-grant保护模型：可在运行时修改这样的图，以模拟用户利用现有权限授予自己新的权限，存在不能准确表示现实生活系统的问题。基于DAG(有向无环图)的模型被广泛用于模拟现实生活中的攻防场景，可分为从威胁树派生的方法和基于贝叶斯网络的方法，如概率攻击图(反映安全危险的概率性质)。在安全控制措施间选择是一个多目标决策问题，[1]的框架有效解决该问题(以概率攻击图形式呈现，与一组降低风险的控制措施结合)。

**建模工具：** 早期建模工具如用于Unix的C++攻击图生成器，把攻击模板(由必要的特权和能力组成的攻击描述，并作为结果获得)、配置概况(网络拓扑、特权集)、攻击者概况(能力)作为输入。后续工具主要集中在从现实的网络图和现有工具导出的漏洞数据库中生成攻击图的问题。NetSPA从netViz文件、NVD漏洞数据库和导出的防火墙规则中生成攻击图。TVA(Topological Vulnerability Analysis)包含一个网络扫描仪用于生成工具图。对MulVAL工具拓展，包括漏洞被利用的概率，使用通用漏洞评分系统等指标，贝叶斯网络的缺点是计算和优化缓慢。

**工业网络安全：** SCADA系统被用来监视和远程控制关键工业过程，是操作技术(OT)的一部分。OT指与物理世界连接的技术，包括工业控制系统(ICS)、SCADA和分布式控制系统(DCS)。与互联网协议连接的系统容易受到专门的攻击和其他互联网的威胁。在工控系统上运行漏洞扫描仪可能造成故障对现实世界产生结果。NetSPA、TVA和MulVAL都依赖于漏洞扫描仪，有必要采取不同办法。

## CYSECTOOL设计和实施

CySecTool是一个使用Python和Bokeh演示库开发的Web应用程序，为[1]中算法优化引擎提供一个前端。攻击图被保存在JSON文件中，存储节点(攻击者的访问级别)、边(提升权限的漏洞)和控制(针对漏洞的反制措施)。图形还可以用附带编辑器编辑。

<img src="pic\p5\p2.png"/>

图2：CySecTool显示的工控攻击图，右侧是安装的控制装置。

界面左边显示所分析场景的攻击图，边的颜色根据成功攻击的概率确定，使用右侧的对数刻度，较粗线条是关键路径(最可能)。初始攻击者的状态节点使用蓝色，目标使用红色。将鼠标悬停在边上可查看边所代表的漏洞的详细信息，应用的控制和流量，点击边进入漏洞详细描述页面(MITRE ATT&CK的ICS数据库中的漏洞描述)。

界面右侧显示控制项，可手动选择一个组合，改变目标，加载和保存模型，启动图形编辑器或优化给定预算。点击"Edit"活动模型被加载到编辑器进行修改，模型可被保存在本地或在CySecTool可视化模块查看。

该程序可在指定预算内生成一个最佳安全控制组合，允许用户生成帕累托边界(在相同或较低预算中不存在更安全的解决方案的所有投资组合的集合)，该方案被称为帕累托最优(Pareto-optimal)。通过绘制图表，可以分析安全性随着预算增加而变化的方式。将鼠标悬停在点上，可获得有关投资组合的其他数据，如确切成本、间接成本和安全损失(最大概率攻击路径)。点击一个点可以应用相关组合。

<img src="pic\p5\p3.png" width="40%" />

图3：适用于ICS模型的“最优”投资组合的帕累托边界。

测试集：使用unittest库和Selenium浏览器自动化工具生成；基于[1]中手动验证和正式验证的结果；开发过程中创建的定制场景。

### 优化程序概述

CySecTool中实施的优化框架和系统建模的案例说明：

<img src="pic\p5\p4.png" width="30%" />

图4：攻击图的玩具示例。边是攻击步骤或漏洞，边上标记应用的控制。ci为部署ci时攻击者在该边攻击成功的概率。

**优化问题：** 假设防御者只能从c1,c2,c3,c4中选择两个安全控制，求使攻击者成功到达顶点3的概率最低的组合。控制可有不同的成本，防御者可有不同的预算。这是一种高度优化：防御者想最小化攻击者达到目标的最大概率。最小化是外部问题，最大化是内部问题。

假设：c1=0.5, c2=c4=0.2, c3=0.1。若防御者选择c3和c4，攻击者将以1的概率沿着(0,1), (1,3)的路径到达3。若选择c2和c3，攻击者最多以0.2的概率到达3，是最佳组合。

## 研究方法

攻击图定义：

1. 顶点(vertices)：攻击者访问权限
2. 边(edges)：漏洞的类别
3. 边的默认流量(default flows over edges)：未缓解的漏洞被利用的默认概率
4. 控制(controls)：缓解措施
5. 流量减少(flow reductions)：如果部署了控制措施，减少漏洞被利用的概率
6. 直接成本(direct costs)：实施控制的货币成本；间接成本(indirect costs)：给利益相关者带来的不便，即停机时间，增加的使用的复杂性

### 顶点(Vertices)/ICS系统

该案例研究基于国家网络安全局所描述的一家中型公用事业提供商的主要运营能力，考虑了IT和OT(操作技术)系统的单个物理操作环境以及与控制单元相关的几个远程站点。环境被分成四部分：OT/SCADA系统、IT系统、现场设备、外部设备和系统，每部分都可以通过概念上的物理或技术分离定义，尽管各部分间存在连接性(对系统安全性至关重要)。该案例所有客户端和服务器都使用微软操作系统。

图1工控系统部分顶点进一步解释：

- ViewX：用于从现场设备控制工厂的前端，具有无限功能
- WebX：面向互联网的前端，用于从外围控制工厂
- OT Active Directory：目录服务的一部分，用于控制对控制系统的访问，由系统IT部分控制
- Vendor software：供应商软件，包括IT和OT软件，“供应链妥协”中可能会发生针对供应商的攻击
- Test System：实际系统的一个缩影，OT软件所有更新都经过测试系统
- Site System：与控制系统通信的现场机器
- Corprate thin client：IT领域的机器，用于管理任务，包括OT的数据准备

### MITRE ATT&CK for ICS

MITRE ATT&CK框架是一个威胁情报数据库，收集“矩阵”包括：战术(tactics，攻击者的目标)、技术和次级技术(实现目标的方法)、缓解措施、程序(技术使用的真实案例)。

MIRE是一个管理通用漏洞和暴露(Common Vulnerabilities and Exposures)以及通用弱点列举(Common Weakness Enumeration)的数据库，ATT&CK是这些数据库的自然延伸，对所使用的战术和技术进行概述。ATT&CK For ICS为工业控制系统的矩阵的命名。整个数据库可以以结构化威胁信息表达的形式下载，是一种基于JSON的语言和序列化格式，用于交换网络威胁情报，MITRE提供了编写与该内容互动的程序的提示。

### 漏洞(Vulnerabilities)

使用Jupyter notebooks分析漏洞，使用一个Python内置的JSON处理库和pandas进行数据处理和显示。

首先，将技术范围缩小到可用于获取控制系统的战术建模：初始访问和横向移动。为了衡量初始风险，将程序(使用该漏洞的黑客团体的实例，从ATT&CK for ICS数据库获取)加入表格，并计算每个漏洞存在多少个程序，初始风险为 $frac{|procedures|}{10}$ ，范围从10%到90%。

### 控制措施(Controls)

### 控制措施成本(Controls' cost)

### 控制措施有效性(Controls' effectiveness)

------

**参考文献**

[1] M. Khouzani, Z. Liu, and P. Malacaria, "Scalable min-max multi-objective cyber-security optimisation over probabilistic attack graphs", Eur. J. Oper. Res., vol. 278, no. 3, pp. 894 – 903, Apr 2019. [Online]. Available: http://sciencedirect.com/science/article/pii/S0377221719303728

**原文**

Optimal Security Hardening over a Probabilistic Attack Graph: A Case Study of an Industrial Control System using CySecTool

**出版**

- Session 1: Cyber Physical Systems Security
- SaT-CPS'22
- April 27, 2022
- Baltimore, MD, USA

**申明**

版权归原文作者及出版单位所有，如有侵权请联系删除
